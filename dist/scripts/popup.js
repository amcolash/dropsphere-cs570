"use strict";$(function(){function a(a){var b=d.getConvo(a);$("#chatBox").empty(),b&&b.forEach(function(a){$("#chatBox").append(a)})}function b(a){h=!0,$("#chatBox li").each(function(){if(!$(this).hasClass("linkItem")){a?$(this).hide():$(this).show();var b=$("#chatBox").prop("scrollHeight")+"px";$("#chatBox").slimScroll({scrollTo:b})}})}function c(){if(!h&&"Me"!=d.currentConvo){var a=["Awesome!","Thats so cool!","meh","I want more!","Seen it already"],b=a[Math.floor(Math.random()*(a.length-1))+0],c='<li class="messageLeft">'+b+"</li> <br>";$("#chatBox").append(c);var e=$("#chatBox").prop("scrollHeight")+"px";$("#chatBox").slimScroll({scrollTo:e}),d.storeMessage(c)}}console.log("'Allo 'Allo! Popup");var d=chrome.extension.getBackgroundPage();d.loggedIn?($("#feed").show(),$("#user").removeClass("invisible")):$("#login").show(),$("#contactList").slimScroll({height:"376px"}),$("#chatBox").slimScroll({height:"337px"}),$(".slimScrollBar").hide();var e=$("#chatBox").prop("scrollHeight")+"px";$("#chatBox").slimScroll({scrollTo:e});var f=[];$("#contacts li").each(function(){f.push($(this).children(".contactName").html())}),d.initializeContacts(f),a(),$(".login").click(function(){d.loggedIn=!0,$("#login input").each(function(){$(this).val("")}),$("#login").hide(),$("#feed").show(),$("#user").removeClass("invisible")}),$("#logout").click(function(){d.loggedIn=!1,$("#login").show(),$("#user").addClass("invisible"),$("#feed").hide()}),$("#filterLinks input").change(function(){b($("#filterLinks input").prop("checked")?!0:!1)});var g,h=!1;$("#chatBox").on("dragstart",".linkItem",function(){g=this.outerHTML}),$("#contacts li").on("dragover",function(a){a.preventDefault(),$(this).addClass("selected")}),$("#contacts li").on("dragleave",function(a){a.preventDefault(),$(this).removeClass("selected")}),$("#contacts li").on("drop",function(b){b.preventDefault();var e=$(this).children(".contactName").html();e!=d.currentConvo&&(d.switchConvo(e),d.storeMessage(g),a(),$("#contacts li").removeClass("selected"),$(this).addClass("selected"),h=!1,setTimeout(c,1e3))}),$("#contacts li").click(function(){var b=$(this).children(".contactName").html();$("#contacts li").removeClass("selected"),$(this).addClass("selected"),h=!0,a(b)}),$("#dropPage").click(function(){chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.tabs.sendMessage(a[0].id,"drop",function(a){var b='<img class="img-responsive" src="'+a.image+'"/>',e='<li draggable="true" class="messageRight linkItem">'+b+'<a target="_blank" href="'+a.link+'">'+a.title+"</a></li>";$("#chatBox").append(e);var f=$("#chatBox").prop("scrollHeight")+"px";$("#chatBox").slimScroll({scrollTo:f}),d.storeMessage(e),h=!1,setTimeout(c,1e3)})})}),$("#feed").on("keypress","input#dropContent",function(a){if(13==a.keyCode&&!a.shiftKey){a.preventDefault();var b=$("#dropContent").val().trim();if(b){var c='<li class="messageRight">'+b+"</li> <br>";$("#chatBox").append(c),$("#dropContent").val(""),d.storeMessage(c);var e=$("#chatBox").prop("scrollHeight")+"px";$("#chatBox").slimScroll({scrollTo:e})}}})});